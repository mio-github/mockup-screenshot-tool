# Changelog

## 2025-10-23 - 画面仕様書自動生成モード強化

### 追加機能
- **Excel画面設計書生成（UPDATE）**
  - 1画面=1シート構成へ刷新し、各シートに番号付きスクリーンショットと要素一覧をレイアウト
  - DOM解析で検出したボタン・リンク・入力項目を自動採番し、UIテキスト / CSSセレクタ / 挙動 / バリデーション情報を統合
  - スクリーンショットへ番号マーカーを重ねたPNGを生成し、シート上に貼り付け
  - CLI: `node bin/spec-sheet.js` / エイリアス: `msc-spec`
  - MCPツール: `generate_spec_sheet` からも同様のExcelを出力可能（出力先・ファイル名指定対応）

## 2025-10-23 - 画面遷移図生成機能追加

### 変更内容

#### 画面遷移図生成機能 (NEW!)
- **SVG形式の画面遷移図**: 実際のスクリーンショットを使用した画面遷移図を自動生成
  - 各画面をサムネイル表示（サイズ指定可能）
  - SVG矢印で遷移関係を表現
  - ラベルと説明文で各画面を解説
  - ホバー時のハイライト効果

- **レイアウトオプション**:
  - `vertical`: 縦並び（デフォルト）
  - `horizontal`: 横並び
  - `grid`: グリッド配置（3列）

- **設定方法**:
  ```json
  {
    "flowDiagram": {
      "enabled": true,
      "fileName": "画面遷移図.svg",
      "layout": "vertical",
      "thumbnailSize": { "width": 320, "height": 180 },
      "nodes": [
        {
          "id": "home",
          "screenshot": "01_ホーム",
          "label": "ホーム画面",
          "description": "フェーズ選択"
        }
      ],
      "edges": [
        { "from": "home", "to": "poc", "label": "PoC開発" }
      ]
    }
  }
  ```

#### 実装詳細
- **lib/flow-diagram-generator.js**: SVG生成コアロジック
- **bin/flow-diagram.js**: CLIコマンド
- **mcp-server.js**: MCPツール `generate_flow_diagram` 追加
- **依存関係**: `sharp`パッケージを追加（画像のリサイズとBase64エンコード用）

#### ドキュメント (`README.md`)
- 画面遷移図生成機能の使用方法を追加
- エイリアス `msc-flow` を追加

### 使用例

```bash
# CLIで実行
node /Users/masayahirano/script/AI-Tools/mio_sc_capture/bin/flow-diagram.js

# またはエイリアスで
msc-flow

# MCPで実行（Claude経由）
"画面遷移図を生成して"
```

### メリット

- **視覚的なドキュメント**: 画面遷移を一目で把握できる
- **実際の画面使用**: スクリーンショットを使用するため、実装イメージが正確
- **柔軟なレイアウト**: プロジェクトに応じて縦・横・グリッド配置を選択可能
- **SVG形式**: 拡大しても劣化せず、ブラウザで直接表示可能

## 2025-10-23 - カスタムカラー対応 & モダン概要ページ追加

### 変更内容

#### アノテーションシステム (`lib/html-generator.js`)
- **カスタムカラー対応**: アノテーションに任意のHEXカラーを指定可能に
  - `color` プロパティでHEX形式（例: `#9333EA`）の色を指定
  - 指定した色から自動的に最適な配色（線色、ポイント色、ボックス色、影）を生成
  - `style` プロパティより優先される（優先順位: `color` > `style` > デフォルト）

- **設定例**:
  ```json
  {
    "x": 500,
    "y": 300,
    "text": "カスタムカラー",
    "description": "好きな色を指定可能",
    "direction": "right",
    "color": "#9333EA"
  }
  ```

#### システム概要ページ (`lib/html-generator.js`)
- **モダンデザインモード追加**: `overview.style` に `"modern"` オプションを追加
  - **グラデーション背景**: 白からライトブルーへの柔らかいグラデーション
  - **カード型レイアウト**: 角丸、影効果、ボーダーアクセント付き
  - **視覚的階層**: アイコン的なチェックマーク、左側のアクセントライン
  - **フラットデザイン**: 適度な影とグラデーションでモダンな印象

- **設定方法**:
  ```json
  {
    "overview": {
      "style": "modern",
      "title": "システム概要",
      "sections": [...]
    }
  }
  ```

#### ドキュメント (`README.md`)
- カスタムカラーパラメータの説明を追加
- モダン概要ページスタイルの使用方法とビジュアル例を追加

### 使用例

```json
{
  "overview": {
    "style": "modern",
    "title": "セルフレジ不正検知AIシステム - システム概要",
    "sections": [
      {
        "heading": "プロジェクト概要",
        "items": ["AIによる不正検知システム", "エッジ・クラウドハイブリッド構成"]
      }
    ]
  },
  "annotations": {
    "cost-highlight": {
      "items": [
        {
          "x": 500,
          "y": 300,
          "text": "月額5〜10万円",
          "description": "カスタムカラーで強調",
          "direction": "right",
          "color": "#10B981"
        }
      ]
    }
  }
}
```

### メリット

- **デザインの自由度向上**: プリセットに縛られず、任意の色を使用可能
- **ブランドカラー対応**: 企業やプロジェクトのブランドカラーを反映可能
- **視覚的品質向上**: モダンでプロフェッショナルな見た目の概要ページ
- **後方互換性**: 既存の設定ファイルはそのまま動作

## 2025-10-23 - アノテーションスタイルプリセット追加 & バグ修正

### 変更内容

#### アノテーションシステム (`lib/html-generator.js`)
- **スタイルプリセット追加**: アノテーションに6種類のスタイルプリセットを追加
  - `default`: オレンジ系（標準）
  - `highlight`: グリーン系（重要情報の強調表示、強調シャドウ付き）
  - `success`: 明るいグリーン系（成功/完了の表示）
  - `danger`: レッド系（警告/エラーの表示）
  - `info`: ブルー系（情報表示）
  - `warning`: イエロー系（注意喚起）

- **設定方法**: 各アノテーションに `style` プロパティを追加
  ```json
  {
    "x": 500,
    "y": 300,
    "text": "月額5〜10万円",
    "description": "エッジ主体型で\nコスト最適化",
    "direction": "right",
    "style": "highlight"
  }
  ```

#### MCPサーバー (`mcp-server.js`)
- **バグ修正**: `add_annotations`、`generate_pdf`、`generate_all`、`record_video` ツールで `configPath` の解決処理が抜けていた問題を修正
- これにより、MCPツール経由での実行時に「configPath is not defined」エラーが発生する問題を解決

#### ドキュメント (`README.md`)
- アノテーションスタイルプリセットの使用方法とサンプルコードを追加
- 各スタイルの用途と視覚的な違いを説明

### 使用例

```json
"annotations": {
  "cost-comparison": {
    "items": [
      {
        "x": 500,
        "y": 300,
        "text": "月額5〜10万円",
        "description": "エッジ主体型で\nコスト最適化を実現",
        "direction": "right",
        "style": "highlight"
      },
      {
        "x": 800,
        "y": 500,
        "text": "月額15〜20万円",
        "description": "クラウド常時解析型",
        "direction": "left",
        "style": "danger"
      }
    ]
  }
}
```

### メリット

- **表現力向上**: 重要情報の強調、警告、成功など、コンテキストに応じた色分けが可能に
- **視認性向上**: `highlight` スタイルは強調シャドウで重要な情報を目立たせる設計
- **柔軟性**: 用途に応じて6種類から選択可能、未指定時はデフォルトスタイル
- **後方互換性**: 既存の設定ファイルはそのまま動作（デフォルトスタイル適用）

## 2025-10-16 - アノテーションなしモード追加

### 変更内容

#### PDF生成スクリプト (`bin/pdf.js`)
- **アノテーションなしモード対応**: 注釈付きスクリーンショットが存在しない場合、元のスクリーンショットを自動的に使用してPDFを生成するように改善

### 動作

1. **注釈付きスクリーンショットが全て存在する場合**
   - 従来通り、注釈付きスクリーンショットを使用してPDF生成

2. **注釈付きスクリーンショットが全て存在しない場合** (NEW!)
   - 元のスクリーンショットディレクトリから画像を読み込んでPDF生成
   - メッセージ: `[!] 注釈付きスクリーンショットが見つかりません。元のスクリーンショットを使用します。`

3. **注釈付きスクリーンショットが一部のみ存在する場合**
   - エラーメッセージを表示して終了（従来通り）
   - アノテーションスクリプトを実行するよう促す

### 使用例

```bash
# スクリーンショット撮影
node /Users/masayahirano/script/AI-Tools/mio_sc_capture/bin/capture.js

# アノテーションをスキップして直接PDF生成
node /Users/masayahirano/script/AI-Tools/mio_sc_capture/bin/pdf.js
```

これにより、アノテーションが不要な場合はスクリーンショット撮影後すぐにPDF生成が可能になりました。

### メリット

- **作業効率向上**: アノテーションが不要な場合、スクリプト実行を1ステップ削減
- **柔軟性向上**: アノテーションの有無に関わらずPDF生成が可能
- **後方互換性**: 既存のワークフロー（アノテーション → PDF生成）もそのまま使用可能
